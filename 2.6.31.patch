--- iscsitarget-1.4.19/kernel/file-io.c~	2008-11-23 18:28:55.000000000 +0100
+++ iscsitarget-1.4.19/kernel/file-io.c	2010-03-16 11:23:00.453373658 +0100
@@ -88,7 +88,7 @@ static int fileio_sync(struct iet_volume
 		count = lu->blk_cnt << lu->blk_shift;
 	}
 
-	res = sync_page_range(inode, mapping, ppos, count);
+	res = filemap_write_and_wait_range(mapping, ppos, ppos + count - 1);
 	if (res) {
 		eprintk("I/O error: syncing pages failed: %d\n", res);
 		return -EIO;
